#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ FastAPI —Å–µ—Ä–≤–µ—Ä–∞..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
if [ ! -d "venv" ]; then
    echo "‚ö†Ô∏è  –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."
    echo "   –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: ./install.sh"
    exit 1
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É uvicorn
if ! command -v uvicorn &> /dev/null; then
    echo "‚ö†Ô∏è  uvicorn –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    pip install -r requirements.txt
fi

echo "üåê –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://0.0.0.0:8000"
echo ""
echo "üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Å—ã–ª–∫–∏:"
echo "   API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://0.0.0.0:8000/docs"
echo "   –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:    http://0.0.0.0:8000/static/index.html"
echo "   ReDoc:            http://0.0.0.0:8000/redoc"
echo ""
echo "üåç –£–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø:"
LOCAL_IP=$(hostname -I | awk '{print $1}' 2>/dev/null || echo "–ø–æ–ª—É—á–∏—Ç–µ IP –∫–æ–º–∞–Ω–¥–æ–π: ip addr")
echo "   –í–Ω–µ—à–Ω–∏–π IP: http://$LOCAL_IP:8000"
echo "   API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://$LOCAL_IP:8000/docs"
echo ""
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞"
echo ""

uvicorn main:app --reload --host 0.0.0.0 --port 8000
