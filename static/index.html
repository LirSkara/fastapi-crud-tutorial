<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD API –¢–µ—Å—Ç–µ—Ä</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h3 {
            margin-top: 0;
            color: #555;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #0056b3;
        }
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            background-color: #e9ecef;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .user-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ FastAPI CRUD –¢–µ—Å—Ç–µ—Ä</h1>
        
        <div class="section">
            <h3>üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ API</h3>
            <button onclick="checkHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
            <div id="health-result" class="result"></div>
        </div>

        <div class="section">
            <h3>üë§ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <input type="text" id="create-name" placeholder="–ò–º—è" />
            <input type="email" id="create-email" placeholder="Email" />
            <input type="number" id="create-age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" />
            <button onclick="createUser()">–°–æ–∑–¥–∞—Ç—å</button>
            <div id="create-result" class="result"></div>
        </div>

        <div class="section">
            <h3>üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <button onclick="getUsers()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <div id="users-list"></div>
        </div>

        <div class="section">
            <h3>üîç –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <input type="number" id="search-id" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <button onclick="getUserById()">–ù–∞–π—Ç–∏ –ø–æ ID</button>
            <br><br>
            <input type="email" id="search-email" placeholder="Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <button onclick="getUserByEmail()">–ù–∞–π—Ç–∏ –ø–æ Email</button>
            <div id="search-result" class="result"></div>
        </div>

        <div class="section">
            <h3>‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <input type="number" id="update-id" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <input type="text" id="update-name" placeholder="–ù–æ–≤–æ–µ –∏–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
            <input type="email" id="update-email" placeholder="–ù–æ–≤—ã–π email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
            <input type="number" id="update-age" placeholder="–ù–æ–≤—ã–π –≤–æ–∑—Ä–∞—Å—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
            <button onclick="updateUser()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <div id="update-result" class="result"></div>
        </div>

        <div class="section">
            <h3>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <input type="number" id="delete-id" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <button class="delete-btn" onclick="deleteUser()">–£–¥–∞–ª–∏—Ç—å</button>
            <div id="delete-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return { data, status: response.status, ok: response.ok };
            } catch (error) {
                return { error: error.message, ok: false };
            }
        }

        async function checkHealth() {
            const result = await makeRequest(`${API_BASE}/health`);
            showResult('health-result', result.data || result.error, !result.ok);
        }

        async function createUser() {
            const name = document.getElementById('create-name').value;
            const email = document.getElementById('create-email').value;
            const age = parseInt(document.getElementById('create-age').value);

            if (!name || !email || !age) {
                showResult('create-result', { error: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è' }, true);
                return;
            }

            const result = await makeRequest(`${API_BASE}/users/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, age })
            });

            showResult('create-result', result.data || result.error, !result.ok);
            
            if (result.ok) {
                document.getElementById('create-name').value = '';
                document.getElementById('create-email').value = '';
                document.getElementById('create-age').value = '';
                getUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            }
        }

        async function getUsers() {
            const result = await makeRequest(`${API_BASE}/users/`);
            
            if (result.ok) {
                const usersContainer = document.getElementById('users-list');
                usersContainer.innerHTML = '';
                
                if (result.data.length === 0) {
                    usersContainer.innerHTML = '<p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                } else {
                    result.data.forEach(user => {
                        const userDiv = document.createElement('div');
                        userDiv.className = 'user-item';
                        userDiv.innerHTML = `
                            <strong>${user.name}</strong> (ID: ${user.id})<br>
                            Email: ${user.email}<br>
                            –í–æ–∑—Ä–∞—Å—Ç: ${user.age}<br>
                            –°–æ–∑–¥–∞–Ω: ${new Date(user.created_at).toLocaleString('ru-RU')}
                        `;
                        usersContainer.appendChild(userDiv);
                    });
                }
            } else {
                showResult('users-list', result.error, true);
            }
        }

        async function getUserById() {
            const id = document.getElementById('search-id').value;
            if (!id) {
                showResult('search-result', { error: '–í–≤–µ–¥–∏—Ç–µ ID' }, true);
                return;
            }

            const result = await makeRequest(`${API_BASE}/users/${id}`);
            showResult('search-result', result.data || result.error, !result.ok);
        }

        async function getUserByEmail() {
            const email = document.getElementById('search-email').value;
            if (!email) {
                showResult('search-result', { error: '–í–≤–µ–¥–∏—Ç–µ email' }, true);
                return;
            }

            const result = await makeRequest(`${API_BASE}/users/email/${email}`);
            showResult('search-result', result.data || result.error, !result.ok);
        }

        async function updateUser() {
            const id = document.getElementById('update-id').value;
            const name = document.getElementById('update-name').value;
            const email = document.getElementById('update-email').value;
            const age = document.getElementById('update-age').value;

            if (!id) {
                showResult('update-result', { error: '–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }, true);
                return;
            }

            const updateData = {};
            if (name) updateData.name = name;
            if (email) updateData.email = email;
            if (age) updateData.age = parseInt(age);

            if (Object.keys(updateData).length === 0) {
                showResult('update-result', { error: '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' }, true);
                return;
            }

            const result = await makeRequest(`${API_BASE}/users/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updateData)
            });

            showResult('update-result', result.data || result.error, !result.ok);
            
            if (result.ok) {
                document.getElementById('update-name').value = '';
                document.getElementById('update-email').value = '';
                document.getElementById('update-age').value = '';
                getUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            }
        }

        async function deleteUser() {
            const id = document.getElementById('delete-id').value;
            if (!id) {
                showResult('delete-result', { error: '–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }, true);
                return;
            }

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID ${id}?`)) {
                return;
            }

            const result = await makeRequest(`${API_BASE}/users/${id}`, {
                method: 'DELETE'
            });

            showResult('delete-result', result.data || result.error, !result.ok);
            
            if (result.ok) {
                document.getElementById('delete-id').value = '';
                getUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = () => {
            checkHealth();
            getUsers();
        };
    </script>
</body>
</html>
